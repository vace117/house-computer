# Setup
```bash
$ python3 -m venv .venv
$ source .venv/bin/activate
$ pip install -U pip
$ pip install -r requirements.txt
$ pip list

Package       Version
------------- -----------
certifi       2020.4.5.1
cffi          1.14.0
chardet       3.0.4
enum34        1.1.6
idna          2.9
numpy         1.18.4
pip           20.1
pkg-resources 0.0.0
pvporcupine   1.7.0
PyAudio       0.2.11
pycparser     2.20
PySoundFile   0.9.0.post1
requests      2.23.0
setuptools    39.0.1
urllib3       1.25.9
```

# House Computer Application
This application detects the wake word and notifies the NodeJS backend that it was detected.

## Usage
```bash
$ python house_computer.py --help
```

In the simplest form, prefix of the wake word file needs to be provided to the script.
```bash
$ python house_computer.py --keywords computer
``` 

This starts recording audio from the default input audio device, initializes an instance of Porcupine library, monitors the incoming audio for the wake word `'computer'`, and uses a REST call to notify the NodeJS back-end when the wake word is detected. 

This is an example console output on a linux machine

````
ALSA lib pcm.c:2495:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.rear
ALSA lib pcm.c:2495:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.center_lfe
ALSA lib pcm.c:2495:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.side
ALSA lib pcm_route.c:867:(find_matching_chmap) Found no matching channel map
[2020-05-19 02:46:19.705390] detected keyword
[2020-05-19 02:50:14.057759] detected keyword
````

There are few lines of output generated by [ALSA](https://en.wikipedia.org/wiki/Advanced_Linux_Sound_Architecture). Don't be alarmed this is normal. 

In order to detect a different wake word change the keyword file.

Also, you can detect multiple wake words concurrently (e.g. Blueberry and Raspberry) using

```bash
$ python house_computer.py --keywords blueberry,raspberry
``` 

Finally, in order to run Porcupine's compressed variant pass in compressed keyword file(s) along with path to compressed model file.

```bash
$ python house_computer.py \
    --keyword_file_paths resources/keyword_files/linux/blueberry_linux_compressed.ppn \
    --model_file_path lib/common/porcupine_compressed_params.pv
``` 

## Troubleshooting

### The demo application does not detect anything. Why?

The most probable cause of this is that the default audio input device recognized by PyAudio is not the one being used.
There are a couple of debugging facilities baked into the application to solve this. First, type the following into the
console

```bash
$ python ./house_computer.py --show_audio_devices_info
```

It provides information about various audio input devices on the box. On a Linux box, this is the console output

```
'index': '0', 'name': 'HDA Intel PCH: ALC892 Analog (hw:0,0)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '2'
'index': '1', 'name': 'HDA Intel PCH: ALC892 Alt Analog (hw:0,2)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '2'
'index': '2', 'name': 'HDA NVidia: HDMI 0 (hw:1,3)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '3', 'name': 'HDA NVidia: HDMI 1 (hw:1,7)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '4', 'name': 'HDA NVidia: HDMI 2 (hw:1,8)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '5', 'name': 'HDA NVidia: HDMI 3 (hw:1,9)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '6', 'name': 'HDA NVidia: HDMI 0 (hw:2,3)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '7', 'name': 'HDA NVidia: HDMI 1 (hw:2,7)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '8', 'name': 'HDA NVidia: HDMI 2 (hw:2,8)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '9', 'name': 'HDA NVidia: HDMI 3 (hw:2,9)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '10', 'name': 'Logitech USB Headset: Audio (hw:3,0)', 'defaultSampleRate': '44100.0', 'maxInputChannels': '1'
'index': '11', 'name': 'sysdefault', 'defaultSampleRate': '48000.0', 'maxInputChannels': '128'
'index': '12', 'name': 'front', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '13', 'name': 'surround21', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '14', 'name': 'surround40', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '15', 'name': 'surround41', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '16', 'name': 'surround50', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '17', 'name': 'surround51', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '18', 'name': 'surround71', 'defaultSampleRate': '44100.0', 'maxInputChannels': '0'
'index': '19', 'name': 'pulse', 'defaultSampleRate': '44100.0', 'maxInputChannels': '32'
'index': '20', 'name': 'dmix', 'defaultSampleRate': '48000.0', 'maxInputChannels': '0'
'index': '21', 'name': 'default', 'defaultSampleRate': '44100.0', 'maxInputChannels': '32'
``` 

It can be seen that the last device (index 21) is considered default. But on this machine, a headset is being used as the input device which has an index of 10. After finding the correct index the application can be invoked as below:

```bash
$ python house_computer.py --keywords computer --input_audio_device_index 10
```

If the problem persists we suggest storing the recorded audio into a file for inspection. This can be achieved by:

```bash
$ python house_computer.py --keywords computer --input_audio_device_index 10 --output_path ~/test.wav
```

If after listening to stored file there is no apparent problem detected please open an issue.
